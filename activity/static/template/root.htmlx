<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Access-Control-Allow-Origin" content="*"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title><!-- TITLE --></title>
    <link rel="stylesheet" href="../../css/activity.css">
    <style type="text/css">
        <!-- CSS -->
    </style>
    <script src="https://cdn-qcloud.zhongan.com/a00000/Project/HealthInsurance/js/zepto.min.js"></script>
    <script src="https://cdn-qcloud.zhongan.com/a00000/Project/HealthInsurance/js/qqdialog.js"></script>
    <script src="https://cdn.iyb.tm/common/js/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="../../js/activity.js"></script>
</head>
<body>
<!-- PAGES -->
</body>

<script>
    ENV.H = <!-- HEIGHT -->;
    var gotoPrd = function(p) {
        var dest = 'https://www.iyunbao.com/open/qrcode/iybQrcodeProduct?productId='+p.productId+'&accountId='+gpo.accountId+'&shareType=<!-- ACT_CODE -->';
        stat("GoProduct", dest, p.productId)
        try{IYB.go(dest);}catch(e){document.location.href = dest;}
    };
    var shareProduct = function(p){
        var dest = 'https://www.iyunbao.com/open/qrcode/iybQrcodeProduct?productId='+p.productId+'&accountId='+gpo.accountId+'&shareType=<!-- ACT_CODE -->';
        p.link = dest;
        stat("ShareProduct", dest)
        iHealthBridge.doAction("share", JSON.stringify(p));
    };
    var stat = function(code, dest, productId) {
        $.ajax({url:"<!-- SERVER -->/stat/action.json", type:"POST", data:JSON.stringify({action:'<!-- ACT_CODE -->/' + code, plus:{productId:productId}, accountId:gpo.accountId, url:dest}), contentType:'application/json;charset=UTF-8', dataType:"json"});
    }
</script>

<script>
    var gpo = {};
    gpo.post = function(url, val, callback, failcall) {
        $.ajax({url:"<!-- SERVER -->" + url, type:"POST", data:JSON.stringify(val), contentType:'application/json;charset=UTF-8', success:callback, error:failcall, dataType:"json"});
    };
    gpo.param = function(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return unescape(r[2]); return null; //返回参数值
    };
    gpo.runJS = function() {
        stat("open", window.location.href, null);
        gpo.refreshAct();
    };
    gpo.refreshAct = function() {
        gpo.ask("init", null, function(r) {
            ENV.init = r;
            refreshText();
        });
    };
    gpo.ask = function(code, val, succ){
        try{
            gpo.post("/npo/temp.json", {activity:'<!-- ACT_CODE -->', event:code, account:gpo.accountId, value:val}, function(r){
                if (r != null && r.result == "success") {
                    if (succ) succ(r.content);
                }
            });
        }catch(e){console.log('post-err', e);}
    };
    var refreshText = function() {
        <!-- JS_TEXT -->
    };
    <!-- JS_ENV -->
    $(document).ready( function() {
        <!-- JS_START -->
        refreshText();
        gpo.accountId = gpo.param("accountId");
        if (gpo.accountId != null && gpo.accountId != "") {
            gpo.runJS();
        } else {
            if (typeof iHealthBridge != "undefined") {
                iHealthBridge.getData("userInfo", "", function(r) {
                    if (r == null || r.accountId == null) {
                        Life.Dialog.alert("无法获取APP用户信息");
                    } else {
                        gpo.accountId = r.accountId;
                        gpo.runJS();
                    }
                });
            } else {
                gpo.post("/iybapi/broker/app/salesmanInfoAjax/getSalemanInfo.json", null, function (r) {
                    if (r.isSuccess)
                        gpo.accountId = r.result.accountId;
                    if (gpo.accountId == null || gpo.accountId == "") {
                        Life.Dialog.alert("无法获取用户信息");
                    } else {
                        gpo.runJS();
                    }
                }, function (r) {
                    Life.Dialog.alert("服务器连接失败，请重试" + JSON.stringify(r));
                });
            }
        }
    });
</script>

</html>
